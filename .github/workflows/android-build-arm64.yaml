name: ğŸ“² Android æ„å»º arm64-v8a æ¶æ„ APK

on:
  workflow_dispatch:
  push:  # æ¯æ¬¡ push åˆ°ä»“åº“æ—¶è§¦å‘
    tags:
      - 'v*'  # æŒ‡å®šè§¦å‘åˆ†æ”¯

jobs:
  setup:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # ç¡®ä¿æœ‰å†™å…¥æƒé™
      packages: write
    steps:
      - name: ğŸ› ï¸ æ£€å‡ºä»£ç ä»“åº“
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          lfs: true

      - name: ğŸš€ è®¾ç½®å¼€å‘ç¯å¢ƒ
        uses: ./.github/actions/setup-flutter-rust
        with:
          platform: android
          rust-targets: 'armv7-linux-androideabi aarch64-linux-android'

      - name: ğŸ” é…ç½®åº”ç”¨ç­¾å
        uses: ./.github/actions/android-signing
        with:
          keystore-base64: ${{ secrets.KEYSTORE_BASE64 }}
          key-alias: ${{ secrets.KEY_ALIAS }}
          store-password: ${{ secrets.STORE_PASSWORD }}
          key-password: ${{ secrets.KEY_PASSWORD }}

      - name: ğŸ› ï¸ æ„å»º arm64-v8a æ¶æ„ APK
        run: |
          flutter build apk --release --target-platform android-arm64 --android-skip-build-dependency-validation

      - name: ğŸ“¤ ä¸Šä¼  arm64-v8a æ¶æ„ APK åˆ° Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: astral-arm64-v8a-apk
          path: build/app/outputs/flutter-apk/app-release.apk